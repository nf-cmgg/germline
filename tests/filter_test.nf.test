nextflow_pipeline {

    name "Filter tests"
    script "main.nf"
    tag "filter_test"

    test("Success") {

        when {
            params {
                filter = true
            }
        }

        then {
            assert workflow.success
            assert file("${outputDir}/ready/Proband_12345/reports/Proband_12345.deepvariant.bcftools_stats.txt").exists()
            assert file("${outputDir}/ready/Proband_12345/reports/Proband_12345.haplotypecaller.bcftools_stats.txt").exists()
            assert file("${outputDir}/ready/Proband_12345/Proband_12345.deepvariant.vcf.gz").exists()
            assert file("${outputDir}/ready/Proband_12345/Proband_12345.deepvariant.bed").exists()
            assert file("${outputDir}/ready/Proband_12345/Proband_12345.haplotypecaller.vcf.gz").exists()
            assert file("${outputDir}/ready/Proband_12345/Proband_12345.haplotypecaller.bed").exists()
            assert file("${outputDir}/individuals/NA24385D2_NVQ_034/reports/NA24385D2_NVQ_034.deepvariant.bcftools_stats.txt").exists()
            assert file("${outputDir}/individuals/NA24385D2_NVQ_034/reports/NA24385D2_NVQ_034.haplotypecaller.bcftools_stats.txt").exists()
            assert file("${outputDir}/individuals/NA24385D2_NVQ_034/NA24385D2_NVQ_034.deepvariant.g.vcf.gz").exists()
            assert file("${outputDir}/individuals/NA24385D2_NVQ_034/NA24385D2_NVQ_034.deepvariant.g.vcf.gz.tbi").exists()
            assert file("${outputDir}/individuals/NA24385D2_NVQ_034/NA24385D2_NVQ_034.haplotypecaller.g.vcf.gz").exists()
            assert file("${outputDir}/individuals/NA24385D2_NVQ_034/NA24385D2_NVQ_034.haplotypecaller.g.vcf.gz.tbi").exists()
            assert file("${outputDir}/individuals/NA24385D2_NVQ_034/NA24385D2_NVQ_034.callable.bed").exists()
            assert file("${outputDir}/individuals/DNA049572/DNA049572.deepvariant.g.vcf.gz").exists()
            assert file("${outputDir}/individuals/DNA049572/DNA049572.deepvariant.g.vcf.gz.tbi").exists()
            assert file("${outputDir}/individuals/DNA049572/DNA049572.haplotypecaller.g.vcf.gz").exists()
            assert file("${outputDir}/individuals/DNA049572/DNA049572.haplotypecaller.g.vcf.gz.tbi").exists()
            assert file("${outputDir}/individuals/DNA049572/DNA049572.callable.bed").exists()
            assert file("${outputDir}/multiqc_reports/multiqc_report.html").exists()
        }
    }
}
