nextflow_pipeline {

    name "Tests of the pipeline with all optional parameters on default"
    script "main.nf"

    test("Success") {

        then {
            assert workflow.success
            assert path("${outputDir}/families/Proband_12345/reports/Proband_12345.TsTv.count").md5 == "c4c5d1d04ad9090639c3524736a4b60e"
            assert path("${outputDir}/families/Proband_12345/reports/Proband_12345.bcftools_stats.txt").md5 == "966a901419d1714d75340243e785333f"
            assert path("${outputDir}/families/Proband_12345/reports/Proband_12345.TsTv.qual").md5 == "4bf18831d72895e706cbf6b79ff3403f"
            assert path("${outputDir}/families/Proband_12345/reports/Proband_12345.FILTER.summary").md5 == "1427238776c9965b01c144b3140a1d7a"
            assert path("${outputDir}/families/Proband_12345/Proband_12345.vcf.gz").linesGzip.contains("chr21	6448991	.	G	C	31.64	.	AC=1;AF=0.500;AN=2;AS_QD=2.91;BaseQRankSum=2.74;DP=28;ExcessHet=0.0000;FS=0.000;MLEAC=1;MLEAF=0.500;MQ=19.21;MQRankSum=-9.800e-01;QD=2.88;ReadPosRankSum=0.992;SOR=0.180	GT:AD:DP:GQ:PL	./.:17,0:17:40	0/1:8,3:11:21:39,0,21")
            assert path("${outputDir}/families/Proband_12345/Proband_12345.vcf.gz.tbi")
            assert path("${outputDir}/individuals/NA24385D2_NVQ_034/NA24385D2_NVQ_034.g.vcf.gz").linesGzip.contains("chr21	2	.	N	<NON_REF>	.	.	END=6118023	GT:DP:GQ:MIN_DP:PL	0/0:0:0:0:0,0,0")
            assert path("${outputDir}/individuals/NA24385D2_NVQ_034/NA24385D2_NVQ_034.g.vcf.gz.tbi")
            assert path("${outputDir}/individuals/NA12878K12_NVQ_034/NA12878K12_NVQ_034.g.vcf.gz").linesGzip.contains("chr21	2	.	N	<NON_REF>	.	.	END=6118038	GT:DP:GQ:MIN_DP:PL	0/0:0:0:0:0,0,0")
            assert path("${outputDir}/individuals/NA12878K12_NVQ_034/NA12878K12_NVQ_034.g.vcf.gz.tbi")
        }
    }
}
